<!DOCTYPE html>
<html lang="en">
<head>
    <title>FaceAPI Live WebCam Demo</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, shrink-to-fit=yes">
    <meta name="application-name" content="FaceAPI">
    <meta name="keywords" content="FaceAPI">
    <meta name="description"
          content="FaceAPI: AI-powered Face Detection, Description & Recognition for Browser and NodeJS using Tensorflow/JS">
    <meta name="msapplication-tooltip"
          content="FaceAPI: AI-powered Face Detection, Description & Recognition for Browser and NodeJS using Tensorflow/JS">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <script src="./index.js" type="module"></script>

    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"></script>
</head>
<body>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.4/nouislider.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.4/nouislider.min.js"></script>
<script async src="filters/opencv.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>

<div id="overlay"></div>
<button id="openPanelButton" class="panel-button">&#9776;</button>

<div id="sidePanel" class="side-panel">
    <button id="closePanelButton" class="panel-button close-button">&times;</button>
    <label class="checkbox-label"> Camera Orientation
        <select id="videoAngle">
            <option value="0">0</option>
            <option value="90">90°</option>
            <option value="180">180°</option>
            <option value="270">270°</option>
        </select>
    </label>
    <label>
        <input type="checkbox" id="mirrorCheckbox" checked> Mirror
    </label>
    <label>
        <span>Gap: <span id="gapValue">2</span></span>
        <input type="range" id="gap" min="0" max="10" value="2" step = "2">
    </label>
    <label>
        <input type="checkbox" id="histogramEqCheckbox"> Histogram Eq
    </label>
    <label>
        <input type="checkbox" id="clahe" checked> Clahe
    </label>
    <div id="clahe-sliders">
        <span>Clip Limit <span id="clip-limit-value">3.0</span></span>
        <input type="range" id="clip-limit-slider" min="1" max="10" step="0.1" value="3.0">
        <br>
        <span>Tile Size <span id="tile-size-value">8x8</span></span>
        <input type="range" id="tile-size-slider" min="4" max="64" step="4" value="8">
    </div>

    <label>
        <input type="checkbox" id="bgSeg"> Background Segmentation
    </label>
    <div id="bgColContainer" style="display: none;">
        <label>
            <span>Background Colour: <span id="bgValue">-1</span></span>
            <input type="range" id="bg" min="-1" max="1" value="-1" step=".1">
        </label>
    </div>
    <label>
        <input type="checkbox" id="edge"> Sharpening Filter
    </label>
    <div id="edge-slider-container" style = "display : none">
        <span>Edge Strength <span id="edge-strength-value">2.0</span></span>
        <input type="range" id="edge-strength-slider" min="0" max="5" step="0.1" value="2.0">
    </div>
    <label>
        <input type="checkbox" id="sobel" checked> Sobel Edge Detection
    </label>
    <label id = "sobelWrapper">
        <span>Sobel Edge Strength: <span id="sobEdgeStrengthVal">.3</span></span>
        <input type="range" id="sobEdgeStrength" min="0" max="1" value=".3" step = ".1">
    </label>
    <label>
        <span style="background-color: yellow;">ROI: <span id="roiValue">1.5</span></span>
        <input type="range" id="roi" min=".1" max="2" value="1.5" step=".05">
    </label>
    <label>
        <span>ROI X offset: <span id="roiXOffsetVal">0</span></span>
        <input type="range" id="roiXOffset" min="-100" max="100" value="0" step="1">
    </label>
    <label>
        <span>ROI Y offset: <span id="roiYOffsetVal">-15</span></span>
        <input type="range" id="roiYOffset" min="-100" max="100" value="-15" step="1">
    </label>
    <label>
        <span>Contrast: <span id="contrastValue">100</span></span>
        <input type="range" id="contrast" min="-100" max="100" value="100">
    </label>
    <label>
        <span>Gamma: <span id="gammValue">1</span></span>
        <input type="range" id="gamma" min="0" max="2" value="1" step=".1">
    </label>
    <span>Grayscale Range: <span id="grayscaleValues">0 - 255</span></span>
    <div id="grayscaleSlider"></div>
    <label>
    </label>
    <span>Grayscale Range (with remapping): <span id="grayscaleMapValues">0 - 255</span></span>
    <div id="grayscaleMapSlider"></div>
    <label>
    </label>
    <span>Grayscale Range (with expo): <span id="grayscaleExpo">0 - 255</span></span>
    <div id="grayscaleExpoSlider"></div>
    <label>
        <label>
            <span style="margin-left: 25px">Expo: <span id="grayExpoValue">1</span></span>
            <input type="range" id="grayExpo" min="1" max="3" value="1">
        </label>
    </label>
    <span>Contrast Enhancement: <span id="contrastEnh">0 - 255</span></span>
    <div id="contrastEnhSlider"></div>
    <label>
    </label>


    <span>Lag: <span id="lagVal">0.7</span></span>
    <input type="range" id="lag" min="0" max=".9" value="0.7" step=".1">
    </label>
    <label>
        <input type="checkbox" id="faceCentered" checked> Center Face
    </label>
    <label>
        <input type="checkbox" id="autoEV" checked> Auto-adjust EV
    </label>
    </label>

    <div id="brightnessRangeWrapper">
        <span>Brightness Range <span id="brightnessRange">115 - 150</span></span>
        <div id="brightnessRangeSlider"></div>
    </div>
    <label>
        <div id="exposureModeWrapper">
            <label for="exposureModeSelect">Exposure Mode:</label>
            <select id="exposureModeSelect">
                <option value="manual">Manual</option>
                <option value="continuous">Continuous</option>
            </select>
        </div>
        <div id="exposureCompWrapper">
            <label>
                <span>EV: <span id="exposureComp">0</span></span>
                <input type="range" id="exposureCompVal" min="0" max="255" value="0">
            </label>
            <label>
                <span>Exposure Time: <span id="exposureTime">150 ms</span></span>
                <input type="range" id="exposureTimeVal" min="0" max="1250" value="150">
            </label>
        </div>


        <label>Filter Order:</label>
        <ul id="functionOrderList">
            <li data-function="contrast">Contrast</li>
            <li data-function="histoEq">Histogram Eq</li>
            <li data-function="clahe">CLAHE</li>
            <li data-function="sharpen">Sharpen</li>
            <li data-function="sobel">Sobel</li>
        </ul>

        <script>
            // Get the list element
            const functionOrderList = document.getElementById('functionOrderList');

            // Initialize Sortable.js on the list element
            Sortable.create(functionOrderList, {
                animation: 150, // Duration of the animation when reordering
                onEnd: () => {
                    // Callback function to execute when the user finishes reordering
                    // You can update the order or trigger other actions here
                    console.log('List order updated');
                }
            });
        </script>
        <label>
            <input type="checkbox" id="outerRoi"> Show Outer ROI
        </label>
        <label>
            <span>Outer ROI Width: <span id="outerROIWidthValue">500</span></span>
            <input type="range" id="outerROIWidth" min="100" max="1000" value="500" step="1">
        </label>
        <label>
            <span>Outer ROI Height: <span id="outerROIHeightValue">500</span></span>
            <input type="range" id="outerROIHeight" min="0" max="1000" value="500" step="1">
        </label>
        <label>
            <span>Min Eye Dist: <span id="minEyeDistValue">0</span></span>
            <input type="range" id="minEyeDist" min="0" max="200" value="0" step="1">
        </label>
        <label>
            <span>Cam Brightness: <span id="camBrightnessValue">0</span></span>
            <input type="range" id="camBrightness" min="-64" max="64" value="0" step="1">
        </label>
        <label>
            <span>Cam Contrast: <span id="camContrastValue">100</span></span>
            <input type="range" id="camContrast" min="0" max="100" value="100" step="1">
        </label>
        <label>
            <span>Cam Saturation: <span id="camSaturationValue">50</span></span>
            <input type="range" id="camSaturation" min="0" max="100" value="50" step="1">
        </label>
        <label>
            <span>Cam Sharpness: <span id="camSharpnessValue">71</span></span>
            <input type="range" id="camSharpness" min="0" max="100" value="71" step="1">
        </label>
        <label>
            <span>Cam Gain: <span id="camGainValue">56</span></span>
            <input type="range" id="camGain" min="1" max="128" value="56" step="1">
        </label>
        <label>
            <span>Cam Backlight: <span id="camBacklightValue">1</span></span>
            <input type="range" id="camBacklight" min="0" max="2" value="1" step=".1">
        </label>
        <div id="whiteBalanceMode">
            <label for="WhiteBalanceModeSelect">Cam White Balance Mode:</label>
            <select id="WhiteBalanceModeSelect">
                <option value="manual">Manual</option>
                <option value="continuous" selected>Continuous</option>
            </select>
        </div>
        <div id="colourTempContainer" style="display: none;">
            <label>
                <span>Cam Colour Temp: <span id="colourTempValue">5500</span></span>
                <input type="range" id="colourTemp" min="2800" max="6500" value="5500" step="50">
            </label>
        </div>
</div>

<div id="top" style="height: auto;">
    <div id="video-container">
        <video id="video" playsinline class="video"></video>
        <!--        <canvas id="canvas" class="canvas"></canvas>-->
        <canvas id="blackCanvas" class="canvas"></canvas>
        <canvas id="canvas" class="canvas"></canvas>

        <!--        <style>-->
        <!--            #blackCanvas {-->
        <!--                background-color : rgba(2,2,2,.5);-->
        <!--                background-size: cover;-->
        <!--            }-->
        <!--        </style>-->
        <button id="playPauseButton" class="play-pause-button">
            <span id="play-icon" style="display: none;">&#9654;</span>
            <span id="pause-icon">&#10074;&#10074;</span>
        </button>
        <div id="fps-display"></div>
    </div>
    <div class=canvas-wrapper>
        <canvas id="gray-canvas" width=150 height=150></canvas>
    </div>
    <div class=canvas-wrapper>
        <canvas id="cropped-canvas" width=150 height=150></canvas>
    </div>
    <div class=canvas-wrapper>
        <canvas id="pixel-canvas" width=150 height=150></canvas>
    </div>

</div>
<div style="display: flex; align-items: center;">
<div class="dmxGrid" id = "dmx1"></div>
<div class="dmxGrid"  id = "dmx2"></div>
    <div class="dmxGrid"  id = "dmx3"></div>

</div>
<script src="./dmx/dmxGrid.js" type = "module"></script> <!-- Link to your JavaScript file -->

<div>

</div>


</body>
</html>
